<script>
function getDonors() {
    return JSON.parse(localStorage.getItem("drop4life_donors")) || [];
}

document.getElementById("requestForm").addEventListener("submit", function(e) {
    e.preventDefault();

    let blood = document.getElementById("reqBlood").value;
    let city = document.getElementById("reqCity").value.trim().toLowerCase();

    let donors = getDonors();

    let matches = donors.filter(d =>
        d.blood === blood &&
        d.city === city &&
        d.avail === "available"
    );

    if (matches.length === 0) {
        matches = donors.filter(d =>
            d.blood === blood &&
            d.avail === "available"
        );
    }

    let box = document.getElementById("matches");
    box.innerHTML = "";

    if (matches.length === 0) {
        box.innerHTML = "<p>No matching donors found.</p>";
        return;
    }

    matches.forEach(d => {
        box.innerHTML += `
            <div class="match-box">
                <strong>${d.name} (${d.blood})</strong><br>
                City: ${d.city}<br>
                Contact: ${d.contact}<br>
            </div>
        `;
    });
});
</script>
