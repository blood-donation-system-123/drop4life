<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DROP4Life — Demo</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f6f7fb;color:#222;margin:0;padding:0}
    header{background:#c62828;color:#fff;padding:20px;text-align:center}
    .container{max-width:980px;margin:24px auto;padding:16px}
    footer{text-align:center;padding:12px;color:#666}
    #matches div {transition: all 0.3s ease;}
  </style>
</head>
<body>

  <header>
    <h1>DROP4Life (Demo)</h1>
    <div>Simple donor registration & request prototype — data saved locally in browser</div>
  </header>

  <!-- ✅ NAVIGATION BAR ADDED -->
  <nav style="
      background:#b30000;
      padding:15px;
      text-align:center;
      font-family: Arial, sans-serif;">
    <a href="main.html" style="color:white; margin:0 15px; text-decoration:none; font-size:18px;">Home</a>
    <a href="donor.html" style="color:white; margin:0 15px; text-decoration:none; font-size:18px;">Register Donor</a>
    <a href="request.html" style="color:white; margin:0 15px; text-decoration:none; font-size:18px;">Blood Request</a>
    <a href="donorlist.html" style="color:white; margin:0 15px; text-decoration:none; font-size:18px;">Donor List</a>
  </nav>
  <!-- END NAV -->

  <main class="container">
    <section class="row g-4">

      <!-- Donor Registration -->
      <div class="col-md-6">
        <div class="card p-3">
          <h2>Register as Donor</h2>
          <form id="donorForm">
            <div class="mb-3">
              <label for="donorName" class="form-label">Name</label>
              <input id="donorName" class="form-control" required>
            </div>
            <div class="mb-3">
              <label for="donorBlood" class="form-label">Blood Group</label>
              <select id="donorBlood" class="form-select" required>
                <option value="">Select</option>
                <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="donorCity" class="form-label">City</label>
              <input id="donorCity" class="form-control" required>
            </div>
            <div class="mb-3">
              <label for="donorContact" class="form-label">Contact</label>
              <input id="donorContact" class="form-control" required>
            </div>
            <div class="mb-3">
              <label for="donorAvail" class="form-label">Availability</label>
              <select id="donorAvail" class="form-select" required>
                <option value="available">Available</option>
                <option value="unavailable">Unavailable</option>
              </select>
            </div>
            <button type="submit" class="btn btn-danger w-100">Register Donor</button>
          </form>
        </div>
      </div>

      <!-- Request Blood -->
      <div class="col-md-6">
        <div class="card p-3">
          <h2>Request Blood</h2>
          <form id="requestForm">
            <div class="mb-3">
              <label for="reqBlood" class="form-label">Required Blood Group</label>
              <select id="reqBlood" class="form-select" required>
                <option value="">Select</option>
                <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="reqCity" class="form-label">City</label>
              <input id="reqCity" class="form-control" required>
            </div>
            <div class="mb-3">
              <label for="reqUrgency" class="form-label">Urgency</label>
              <select id="reqUrgency" class="form-select">
                <option value="normal">Normal</option>
                <option value="urgent">Urgent</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="reqContact" class="form-label">Your Contact</label>
              <input id="reqContact" class="form-control" required>
            </div>

            <button type="submit" class="btn btn-danger w-100">Find Donors</button>
            <button type="button" id="resetResults" class="btn btn-secondary w-100 mt-2">Reset Results</button>
          </form>
        </div>
      </div>

    </section>

    <!-- Results -->
    <div class="card p-3 mt-4">
      <h2>Results & History</h2>
      <div id="messages">Donors registered: 0</div>
      <div id="matches"></div>
      <ul id="historyList"></ul>
    </div>
  </main>

  <footer>Demo: data kept locally in your browser. For production, a server & database are required.</footer>

  <!-- ========== SCRIPT (unchanged) ========== -->
  <script>
    const DONOR_KEY = 'drop4life_donors';
    const REQ_KEY = 'drop4life_requests';
    const uid = ()=>Date.now().toString(36)+Math.random().toString(36).slice(2,6);
    const load = (k)=> JSON.parse(localStorage.getItem(k)||'[]');
    const save = (k,v)=> localStorage.setItem(k, JSON.stringify(v));

    function refresh() {
      const donors = load(DONOR_KEY); 
      document.getElementById('messages').innerText = 'Donors registered: '+donors.length;
      const reqs = load(REQ_KEY);
      const h = document.getElementById('historyList'); 
      h.innerHTML='';
      if(reqs.length===0) h.innerHTML='<li>No requests yet</li>';
      reqs.forEach(r=>{
        const li=document.createElement('li'); 
        li.textContent = r.blood+' in '+r.city+' — '+(r.urgency||'normal'); 
        h.appendChild(li);
      });
    }

    document.getElementById('donorForm').addEventListener('submit', e=>{
      e.preventDefault();
      const d = { id:uid(), 
        name:document.getElementById('donorName').value.trim(),
        blood:document.getElementById('donorBlood').value, 
        city:document.getElementById('donorCity').value.trim().toLowerCase(),
        contact:document.getElementById('donorContact').value.trim(), 
        avail:document.getElementById('donorAvail').value 
      };
      const arr = load(DONOR_KEY); arr.push(d); save(DONOR_KEY,arr); 
      alert('Donor saved (demo)'); e.target.reset(); refresh();
    });

    document.getElementById('requestForm').addEventListener('submit', e=>{
      e.preventDefault();
      const r = { id:uid(), 
        blood:document.getElementById('reqBlood').value, 
        city:document.getElementById('reqCity').value.trim().toLowerCase(),
        urgency:document.getElementById('reqUrgency').value, 
        contact:document.getElementById('reqContact').value, 
        time:new Date().toISOString()
      };
      const arr = load(REQ_KEY); arr.unshift(r); save(REQ_KEY,arr); 
      alert('Search started (demo)'); 
      findAndShow(r); 
      e.target.reset(); 
      refresh();
    });

    document.getElementById("resetResults").addEventListener("click", () => {
        document.getElementById("matches").innerHTML = "";
        document.getElementById("historyList").innerHTML = "";
        alert("Results cleared!");
    });

    function findAndShow(request){
        const donors = load(DONOR_KEY);
        let matches = donors.filter(d=>d.blood===request.blood && d.city===request.city && d.avail==='available');
        if(matches.length===0) matches = donors.filter(d=>d.blood===request.blood && d.avail==='available');

        const mdiv = document.getElementById('matches');
        mdiv.innerHTML = '';

        if(matches.length===0){ mdiv.innerHTML='<p>No matches found.</p>'; return;}

        matches.forEach(m=>{
            const el = document.createElement('div');
            el.className = 'p-3 mb-2 border rounded';
            el.style.backgroundColor = m.avail==='available'?'#d4edda':'#f8d7da';
            el.innerHTML = `<strong>${m.name} (${m.blood})</strong>
                            <div>City: ${m.city}</div>
                            <div>Contact: ${m.contact}</div>
                            <button data-id="${m.id}" class="btn btn-sm btn-outline-danger mt-2">Mark Contacted</button>`;
            mdiv.appendChild(el);
        });

        Array.from(document.querySelectorAll('[data-id]')).forEach(btn=>btn.addEventListener('click', ()=>{
            const id=btn.getAttribute('data-id'); 
            const arr=load(DONOR_KEY); 
            const d=arr.find(x=>x.id===id); 
            if(d){ 
                d.avail='unavailable'; 
                save(DONOR_KEY,arr); 
                alert('Marked as unavailable (demo)'); 
                refresh(); 
                findAndShow(request); 
            }
        }));
    }

    (function init(){
        if(!localStorage.getItem(DONOR_KEY)){
            save(DONOR_KEY, [
                { id:uid(), name:'Asha', blood:'O+', city:'delhi', contact:'9876500001', avail:'available' },
                { id:uid(), name:'Ravi', blood:'B-', city:'delhi', contact:'9876500002', avail:'available' }
            ]);
        }
        refresh();
    })();
  </script>

</body>
</html>
